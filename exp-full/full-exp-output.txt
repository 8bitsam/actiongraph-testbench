--- Starting k-NN Comparison Pipeline ---
k-NN Distance Metric: cosine
Steps to run: all

>>> Executing Step: Convert MP to ActionGraphs <<<
--- Running Filtered MP JSON to ActionGraph Conversion & Deduplication ---
Found 13057 potential JSON files in /home/user/Documents/dev/actiongraph-testbench/Data/filtered-mp-data/. Loading...
Loading original MP JSONs: 100%|████████| 13057/13057 [00:01<00:00, 8459.26it/s]
Loaded 13057 entries from /home/user/Documents/dev/actiongraph-testbench/Data/filtered-mp-data/.
Loaded 13057 raw MP entries.

Deduplicating original MP JSON entries (Recipe Content)...
Deduplicating MP JSONs: 100%|██████████| 13057/13057 [00:00<00:00, 27763.34it/s]
Removed 1067 duplicate MP entries. Proceeding with 11990 unique MP entries.

Converting unique MP entries to ActionGraphs and serializing...
Converting unique MP to AGs:   0%|                    | 0/11990 [00:00<?, ?it/s]/home/user/miniconda3/envs/pyg/lib/python3.12/site-packages/networkx/readwrite/json_graph/node_link.py:142: FutureWarning: 
The default value will be `edges="edges" in NetworkX 3.6.

To make this warning go away, explicitly set the edges kwarg, e.g.:

  nx.node_link_data(G, edges="links") to preserve current behavior, or
  nx.node_link_data(G, edges="edges") for forward compatibility.
  warnings.warn(
Converting unique MP to AGs: 100%|██████| 11990/11990 [00:02<00:00, 4325.58it/s]
Successfully attempted conversion for 11860 unique MP entries.
130 unique MP entries skipped by AG.from_mp_synthesis.

Deduplicating serialized ActionGraphs (AG Content)...
Deduplicating AGs: 100%|███████████████| 11860/11860 [00:01<00:00, 10640.86it/s]
AG Deduplication took 1.12 seconds.
Removed 2 duplicate ActionGraphs based on content.
Proceeding with 11858 final unique ActionGraphs.

Saving final unique ActionGraph JSONs to: /home/user/Documents/dev/actiongraph-testbench/Data/filtered-ag-data/
Saving final AGs: 100%|█████████████████| 11858/11858 [00:02<00:00, 3972.49it/s]
Successfully saved 11858 final unique ActionGraph JSON files.
Filtered ActionGraph conversion step completed successfully.
Step 'Convert MP to ActionGraphs' finished in 9.13s.

>>> Executing Step: Featurize Baseline k-NN <<<
--- Running Baseline k-NN Featurization (Target-Only from MP JSONs) ---
Found 13057 potential JSON files in /home/user/Documents/dev/actiongraph-testbench/Data/filtered-mp-data/. Loading...
Loading MP JSONs for Baseline: 100%|███| 13057/13057 [00:01<00:00, 10719.25it/s]
Loaded 13057 entries from /home/user/Documents/dev/actiongraph-testbench/Data/filtered-mp-data/.

Deduplicating MP JSON entries...
Removed 1067 duplicate MP entries. Unique entries: 11990
Creating global element map...
Scanning elements for map: 100%|██████| 11990/11990 [00:00<00:00, 100272.58it/s]
Global element map created with 118 elements.

Featurizing target products...
Featurizing baseline targets: 100%|█████| 11990/11990 [00:01<00:00, 8813.02it/s]
Processed 11989 entries. Skipped 1.
Final feature array shape: (11989, 124)
Saving featurized data to: /home/user/Documents/dev/actiongraph-testbench/Data/featurized-baseline-knn/
Featurized data saved successfully.
Step 'Featurize Baseline k-NN' finished in 4.77s.

>>> Executing Step: Train Baseline k-NN <<<
--- Running Generic k-NN Training ---
Reading features from: /home/user/Documents/dev/actiongraph-testbench/Data/featurized-baseline-knn/
Saving model artifacts to: /home/user/Documents/dev/actiongraph-testbench/Data/models/baseline-knn-model/
Using k=1, distance_metric='cosine'
Loaded 11989 userples. Feature shape: (11989, 124)
Training set size: 8991
Fitting scaler (StandardScaler)...
Training k-NN model...
k-NN training took 0.00 seconds.
Saving artifacts...
Generic k-NN Training step completed.
Step 'Train Baseline k-NN' finished in 0.52s.

>>> Executing Step: Evaluate Baseline k-NN <<<
--- Running Generic k-NN Evaluation ---
Reading features from: /home/user/Documents/dev/actiongraph-testbench/Data/featurized-baseline-knn/
Loading model artifacts from: /home/user/Documents/dev/actiongraph-testbench/Data/models/baseline-knn-model/
Loaded 11989 total userples for evaluation context.
Model info: {'model_type': 'knn', 'k': 1, 'metric': 'cosine', 'featurized_input_dir': ''}

--- Evaluation Summary ---
Model: knn from 
Test Set Size: 2998

-- Precursor Metrics --
avg_precursors_exact_match    : 0.4746
avg_precursors_f1             : 0.7734

-- Operation Metrics --
avg_op_type_f1                : 0.7406

Generic k-NN Evaluation step completed.
Step 'Evaluate Baseline k-NN' finished in 1.42s.

>>> Executing Step: Featurize AG C_out for k-NN <<<
--- Running AG C_out k-NN Featurization ---
Found 11858 potential JSON files in /home/user/Documents/dev/actiongraph-testbench/Data/filtered-ag-data/. Loading...
Loading Serialized AGs: 100%|██████████| 11858/11858 [00:00<00:00, 13452.92it/s]
Loaded 11858 entries from /home/user/Documents/dev/actiongraph-testbench/Data/filtered-ag-data/.
/home/user/miniconda3/envs/pyg/lib/python3.12/site-packages/networkx/readwrite/json_graph/node_link.py:287: FutureWarning: 
The default value will be changed to `edges="edges" in NetworkX 3.6.

To make this warning go away, explicitly set the edges kwarg, e.g.:

  nx.node_link_graph(data, edges="links") to preserve current behavior, or
  nx.node_link_graph(data, edges="edges") for forward compatibility.
  warnings.warn(
Creating global element map...
Scanning elements for map: 100%|██████| 11858/11858 [00:00<00:00, 102991.33it/s]
Global element map created with 118 elements.

Featurizing C_out nodes from ActionGraphs...
Featurizing AG C_out nodes: 100%|███████| 11858/11858 [00:03<00:00, 3255.88it/s]
Processed 11857 AGs for C_out features. Skipped 1.
Final feature array shape: (11857, 124)
Saving featurized data to: /home/user/Documents/dev/actiongraph-testbench/Data/featurized-ag-cout-knn/
Featurized data saved successfully.
Step 'Featurize AG C_out for k-NN' finished in 7.12s.

>>> Executing Step: Train AG C_out k-NN <<<
--- Running Generic k-NN Training ---
Reading features from: /home/user/Documents/dev/actiongraph-testbench/Data/featurized-ag-cout-knn/
Saving model artifacts to: /home/user/Documents/dev/actiongraph-testbench/Data/models/ag-cout-knn-model/
Using k=1, distance_metric='cosine'
Loaded 11857 userples. Feature shape: (11857, 124)
Training set size: 8892
Fitting scaler (StandardScaler)...
Training k-NN model...
k-NN training took 0.00 seconds.
Saving artifacts...
Generic k-NN Training step completed.
Step 'Train AG C_out k-NN' finished in 0.36s.

>>> Executing Step: Evaluate AG C_out k-NN <<<
--- Running Generic k-NN Evaluation ---
Reading features from: /home/user/Documents/dev/actiongraph-testbench/Data/featurized-ag-cout-knn/
Loading model artifacts from: /home/user/Documents/dev/actiongraph-testbench/Data/models/ag-cout-knn-model/
Loaded 11857 total userples for evaluation context.
Model info: {'model_type': 'knn', 'k': 1, 'metric': 'cosine', 'featurized_input_dir': ''}

--- Evaluation Summary ---
Model: knn from 
Test Set Size: 2965

-- Precursor Metrics --
avg_precursors_exact_match    : 0.0000
avg_precursors_f1             : 0.0000

-- Operation Metrics --
avg_op_type_f1                : 1.0000

Generic k-NN Evaluation step completed.
Step 'Evaluate AG C_out k-NN' finished in 0.97s.

>>> Executing Step: Featurize AG Graph Stats for k-NN <<<
--- Running AG Graph-Level k-NN Featurization ---
Found 11858 potential JSON files in /home/user/Documents/dev/actiongraph-testbench/Data/filtered-ag-data/. Loading...
Loading Serialized AGs: 100%|██████████| 11858/11858 [00:01<00:00, 11457.58it/s]
Loaded 11858 entries from /home/user/Documents/dev/actiongraph-testbench/Data/filtered-ag-data/.

Extracting graph-level features from ActionGraphs...
Featurizing AG graph stats:   0%|                     | 0/11858 [00:00<?, ?it/s]/home/user/miniconda3/envs/pyg/lib/python3.12/site-packages/networkx/readwrite/json_graph/node_link.py:287: FutureWarning: 
The default value will be changed to `edges="edges" in NetworkX 3.6.

To make this warning go away, explicitly set the edges kwarg, e.g.:

  nx.node_link_graph(data, edges="links") to preserve current behavior, or
  nx.node_link_graph(data, edges="edges") for forward compatibility.
  warnings.warn(
Featurizing AG graph stats: 100%|███████| 11858/11858 [00:02<00:00, 5113.55it/s]
Processed 11858 AGs for graph features. Skipped 0.
Final feature array shape: (11858, 10)
Saving featurized data to: /home/user/Documents/dev/actiongraph-testbench/Data/featurized-ag-graph-knn/
Featurized data saved successfully.
Step 'Featurize AG Graph Stats for k-NN' finished in 4.45s.

>>> Executing Step: Train AG Graph Stats k-NN <<<
--- Running Generic k-NN Training ---
Reading features from: /home/user/Documents/dev/actiongraph-testbench/Data/featurized-ag-graph-knn/
Saving model artifacts to: /home/user/Documents/dev/actiongraph-testbench/Data/models/ag-graph-knn-model/
Using k=1, distance_metric='cosine'
Loaded 11858 userples. Feature shape: (11858, 10)
Training set size: 8893
Fitting scaler (StandardScaler)...
Training k-NN model...
k-NN training took 0.00 seconds.
Saving artifacts...
Generic k-NN Training step completed.
Step 'Train AG Graph Stats k-NN' finished in 0.32s.

>>> Executing Step: Evaluate AG Graph Stats k-NN <<<
--- Running Generic k-NN Evaluation ---
Reading features from: /home/user/Documents/dev/actiongraph-testbench/Data/featurized-ag-graph-knn/
Loading model artifacts from: /home/user/Documents/dev/actiongraph-testbench/Data/models/ag-graph-knn-model/
Loaded 11858 total userples for evaluation context.
Model info: {'model_type': 'knn', 'k': 1, 'metric': 'cosine', 'featurized_input_dir': ''}

--- Evaluation Summary ---
Model: knn from 
Test Set Size: 2965

-- Precursor Metrics --
avg_precursors_exact_match    : 0.0000
avg_precursors_f1             : 0.0000

-- Operation Metrics --
avg_op_type_f1                : 1.0000

Generic k-NN Evaluation step completed.
Step 'Evaluate AG Graph Stats k-NN' finished in 0.94s.

--- Full Comparison Pipeline Finished (Overall Success: True) ---
Total execution time: 30.02 seconds.
